!function(){"use strict";function e(e){for(var t=0;t<e.length;t++){var r=e[t];r.intersectionRatio&&r.target.loadImage()}}var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=new WeakMap,s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a=void 0;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)a=Promise.resolve();else{var c=new URL("intersection-observer.js",document.currentScript.src);a=new Promise(function(e,t){var r=document.createElement("script");r.src=c.href,r.onload=e,r.onerror=t,document.documentElement.appendChild(r)})}var l=function(c){function l(){t(this,l);var e=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return e.shadow=e.attachShadow({mode:"open"}),e._img=document.createElement("img"),e._img.style.width="100%",e._img.style.height="100%",e._img.src=s,e.shadow.appendChild(e._img),e._margin="0px 0px 0px 0px",e._threshold=.1,e._observe=null,e}return n(l,c),r(l,null,[{key:"observedAttributes",get:function(){return["alt","src","margin","threshold","observe"]}}]),r(l,[{key:"connectedCallback",value:function(){this.style.display="inline-block"}},{key:"disconnectedCallback",value:function(){this.stopObserving()}},{key:"attributeChangedCallback",value:function(e,t,r){t!==r&&(this[e]=r)}},{key:"loadImage",value:function(){var e=this;this._img.onload=function(){e.setAttribute("loaded","");var t=new Event("load");t.detail={originalTarget:e._img},e.dispatchEvent(t)},this._img.src=this._src,this.stopObserving()}},{key:"stopObserving",value:function(){this._observer&&(this._observer.unobserve(this),--this._observer._lazyImgCount<=0&&this.deleteObserver(this._observer),this._observer=null)}},{key:"startObserving",value:function(){var e=this;this.getObserver().then(function(t){e._observer=t,e._observer.observe(e),e._observer._lazyImgCount++})}},{key:"getObserver",value:function(){var t=this;return a.then(function(){var r,n=t._observe?t.getClosest():null,o=n||document.documentElement,s={root:n,rootMargin:t._margin,threshold:t._threshold},a=i.get(o);a||(a=new Map,i.set(o,a));var c=s.rootMargin+"/"+s.threshold;return r=a.get(c),r||(r=new IntersectionObserver(e,s),r._lazyImgKey=c,r._lazyImgCount=0,a.set(c,r)),r})}},{key:"deleteObserver",value:function(e){var t=i.get(e.root);t&&(t.delete(e._lazyImgKey),0===t.size&&i.delete(e.root)),e.disconnect()}},{key:"getClosest",value:function(){for(var e=this;e.host||e.matches&&!e.matches(this._observe);)e=e.host||e.parentNode;return e.matches?e:null}},{key:"src",get:function(){return this._src},set:function(e){this.stopObserving(),this.removeAttribute("loaded"),this._src=e,this._img.src=s,this.startObserving(),this.setAttribute("src",e)}},{key:"alt",get:function(){return this._alt},set:function(e){this._alt=this._img.alt=e,this.setAttribute("alt",e)}},{key:"margin",get:function(){return this._margin},set:function(e){this._margin=e,this.setAttribute("margin",e)}},{key:"threshold",get:function(){return this._threshold},set:function(e){this._threshold=e,this.setAttribute("threshold",e)}},{key:"observe",get:function(){return this._observe},set:function(e){this._observe=e,this.setAttribute("observe",e)}}]),l}(HTMLElement);window.customElements.define("lazy-img",l)}();
//# sourceMappingURL=lazy-img.es5.js.map
