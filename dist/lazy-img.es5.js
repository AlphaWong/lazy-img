!function(){"use strict";function e(e){for(var t=0;t<e.length;t++){var r=e[t];r.intersectionRatio&&r.target.loadImage()}}var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=new WeakMap,s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a=void 0;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)a=Promise.resolve();else{var c=new URL("intersection-observer.js",document.currentScript.src);a=new Promise(function(e,t){var r=document.createElement("script");r.src=c.href,r.onload=e,r.onerror=t,document.documentElement.appendChild(r)})}var l=function(c){function l(){t(this,l);var e=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return e.shadow=e.attachShadow({mode:"open"}),e.img=document.createElement("img"),e.img.style.width="100%",e.img.style.height="100%",e.img.src=s,e.shadow.appendChild(e.img),e.margin="0px 0px 0px 0px",e.threshold=.1,e.observe=null,e}return n(l,c),r(l,null,[{key:"observedAttributes",get:function(){return["src","alt","margin","threshold","observe"]}}]),r(l,[{key:"connectedCallback",value:function(){this.style.display="inline-block"}},{key:"disconnectedCallback",value:function(){this.stopObserving()}},{key:"attributeChangedCallback",value:function(e,t,r){if(t!==r)switch(e){case"alt":this.img.alt=r;break;case"src":this.onSrcChanged(r);break;case"margin":this.margin=r;break;case"threshold":this.threshold=r;break;case"observe":this.observe=r}}},{key:"onSrcChanged",value:function(e){this.stopObserving(),this.removeAttribute("loaded"),this._src=e,this.img.src=s,this.startObserving()}},{key:"loadImage",value:function(){var e=this;this.img.onload=function(){e.setAttribute("loaded","")},this.img.src=this._src,this.stopObserving()}},{key:"stopObserving",value:function(){this.observer&&(this.observer.unobserve(this),--this.observer._lazyImgCount<=0&&this.deleteObserver(this.observer),this.observer=null)}},{key:"startObserving",value:function(){var e=this;this.getObserver().then(function(t){e.observer=t,e.observer.observe(e),e.observer._lazyImgCount++})}},{key:"getObserver",value:function(){var t=this;return a.then(function(){var r,n=t.observe?t.getClosest():null,o=n||document.documentElement,s={root:n,rootMargin:t.margin,threshold:t.threshold},a=i.get(o);a||(a=new Map,i.set(o,a));var c=s.rootMargin+"/"+s.threshold;return r=a.get(c),r||(r=new IntersectionObserver(e,s),r._lazyImgKey=c,r._lazyImgCount=0,a.set(c,r)),r})}},{key:"deleteObserver",value:function(e){var t=i.get(e.root);t&&(t.delete(e._lazyImgKey),0===t.size&&i.delete(e.root)),e.disconnect()}},{key:"getClosest",value:function(){for(var e=this;e.host||e.matches&&!e.matches(this.observe);)e=e.host||e.parentNode;return e.matches?e:null}}]),l}(HTMLElement);window.customElements.define("lazy-img",l)}();
//# sourceMappingURL=lazy-img.es5.js.map
