!function(){"use strict";function t(t){for(var e=0;e<t.length;e++){var s=t[e];s.intersectionRatio&&s.target.loadImage()}}var e=new WeakMap;const s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let i;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)i=Promise.resolve();else{const t=new URL("intersection-observer.js",document.currentScript.src);i=new Promise(function(e,s){var i=document.createElement("script");i.src=t.href,i.onload=e,i.onerror=s,document.documentElement.appendChild(i)})}class n extends HTMLElement{static get observedAttributes(){return["alt","src","margin","threshold","observe"]}constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this._img=document.createElement("img"),this._img.style.width="100%",this._img.style.height="100%",this._img.src=s,this.shadow.appendChild(this._img),this._margin="0px 0px 0px 0px",this._threshold=.1,this._observe=null}connectedCallback(){this.style.display="inline-block"}disconnectedCallback(){this.stopObserving()}attributeChangedCallback(t,e,s){e!==s&&(this[t]=s)}get src(){return this._src}set src(t){this.stopObserving(),this.removeAttribute("loaded"),this._src=t,this._img.src=s,this.startObserving(),this.setAttribute("src",t)}get alt(){return this._alt}set alt(t){this._alt=this._img.alt=t,this.setAttribute("alt",t)}get margin(){return this._margin}set margin(t){this._margin=t,this.setAttribute("margin",t)}get threshold(){return this._threshold}set threshold(t){this._threshold=t,this.setAttribute("threshold",t)}get observe(){return this._observe}set observe(t){this._observe=t,this.setAttribute("observe",t)}loadImage(){this._img.onload=(()=>{this.setAttribute("loaded","");var t=new Event("load");t.detail={originalTarget:this._img},this.dispatchEvent(t)}),this._img.src=this._src,this.stopObserving()}stopObserving(){this._observer&&(this._observer.unobserve(this),--this._observer._lazyImgCount<=0&&this.deleteObserver(this._observer),this._observer=null)}startObserving(){this.getObserver().then(t=>{this._observer=t,this._observer.observe(this),this._observer._lazyImgCount++})}getObserver(){return i.then(()=>{var s,i=this._observe?this.getClosest():null,n=i||document.documentElement,r={root:i,rootMargin:this._margin,threshold:this._threshold},o=e.get(n);o||(o=new Map,e.set(n,o));var h=r.rootMargin+"/"+r.threshold;return s=o.get(h),s||(s=new IntersectionObserver(t,r),s._lazyImgKey=h,s._lazyImgCount=0,o.set(h,s)),s})}deleteObserver(t){var s=e.get(t.root);s&&(s.delete(t._lazyImgKey),0===s.size&&e.delete(t.root)),t.disconnect()}getClosest(){for(var t=this;t.host||t.matches&&!t.matches(this._observe);)t=t.host||t.parentNode;return t.matches?t:null}}window.customElements.define("lazy-img",n)}();
//# sourceMappingURL=lazy-img.es6.js.map
