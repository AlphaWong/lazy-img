!function(){"use strict";function e(e){for(var t=0;t<e.length;t++){var s=e[t];s.intersectionRatio&&s.target.loadImage()}}var t=new WeakMap;const s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let i;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)i=Promise.resolve();else{const e=new URL("intersection-observer.js",document.currentScript.src);i=new Promise(function(t,s){var i=document.createElement("script");i.src=e.href,i.onload=t,i.onerror=s,document.documentElement.appendChild(i)})}class r extends HTMLElement{static get observedAttributes(){return["src","alt","margin","threshold","observe"]}constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.img=document.createElement("img"),this.img.style.width="100%",this.img.style.height="100%",this.img.src=s,this.shadow.appendChild(this.img),this.margin="0px 0px 0px 0px",this.threshold=.1,this.observe=null}connectedCallback(){this.style.display="inline-block"}disconnectedCallback(){this.stopObserving()}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"alt":this.img.alt=s;break;case"src":this.onSrcChanged(s);break;case"margin":this.margin=s;break;case"threshold":this.threshold=s;break;case"observe":this.observe=s}}onSrcChanged(e){this.stopObserving(),this.removeAttribute("loaded"),this._src=e,this.img.src=s,this.startObserving()}loadImage(){this.img.onload=(()=>{this.setAttribute("loaded","")}),this.img.src=this._src,this.stopObserving()}stopObserving(){this.observer&&(this.observer.unobserve(this),--this.observer._lazyImgCount<=0&&this.deleteObserver(this.observer),this.observer=null)}startObserving(){this.getObserver().then(e=>{this.observer=e,this.observer.observe(this),this.observer._lazyImgCount++})}getObserver(){return i.then(()=>{var s,i=this.observe?this.getClosest():null,r=i||document.documentElement,n={root:i,rootMargin:this.margin,threshold:this.threshold},o=t.get(r);o||(o=new Map,t.set(r,o));var h=n.rootMargin+"/"+n.threshold;return s=o.get(h),s||(s=new IntersectionObserver(e,n),s._lazyImgKey=h,s._lazyImgCount=0,o.set(h,s)),s})}deleteObserver(e){var s=t.get(e.root);s&&(s.delete(e._lazyImgKey),0===s.size&&t.delete(e.root)),e.disconnect()}getClosest(){for(var e=this;e.host||e.matches&&!e.matches(this.observe);)e=e.host||e.parentNode;return e.matches?e:null}}window.customElements.define("lazy-img",r)}();
//# sourceMappingURL=lazy-img.es6.js.map
